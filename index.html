<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ماشین حساب تخصصی الکتریکال - نسخه پیشرفته</title>
    <!-- SheetJS Library for Excel Export -->
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Tahoma, Arial, sans-serif;
            overflow-x: hidden;
            background: #0a0a0a;
        }
        .hidden {
            display: none !important;
        }
        
        /* Animated Background with Moving Gradient */
        .animated-bg {
            position: fixed;
            inset: 0;
            background: linear-gradient(135deg, #0f172a 0%, #1e3a8a 25%, #0891b2 50%, #7c3aed 75%, #1e293b 100%);
            background-size: 400% 400%;
            animation: gradientFlow 20s ease infinite;
            z-index: -3;
        }
        @keyframes gradientFlow {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Electrical Circuit Pattern Background */
        .circuit-bg {
            position: fixed;
            inset: 0;
            z-index: -2;
            opacity: 0.15;
            background-image: 
                repeating-linear-gradient(0deg, transparent, transparent 100px, rgba(59, 130, 246, 0.3) 100px, rgba(59, 130, 246, 0.3) 102px),
                repeating-linear-gradient(90deg, transparent, transparent 100px, rgba(59, 130, 246, 0.3) 100px, rgba(59, 130, 246, 0.3) 102px),
                repeating-linear-gradient(45deg, transparent, transparent 50px, rgba(8, 145, 178, 0.2) 50px, rgba(8, 145, 178, 0.2) 51px),
                repeating-linear-gradient(-45deg, transparent, transparent 50px, rgba(8, 145, 178, 0.2) 50px, rgba(8, 145, 178, 0.2) 51px);
            animation: circuitMove 60s linear infinite;
        }
        @keyframes circuitMove {
            0% { transform: translate(0, 0); }
            100% { transform: translate(100px, 100px); }
        }
        
        /* Circuit Nodes */
        .circuit-bg::before {
            content: '';
            position: absolute;
            inset: 0;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(59, 130, 246, 0.4) 2px, transparent 3px),
                radial-gradient(circle at 30% 40%, rgba(8, 145, 178, 0.4) 2px, transparent 3px),
                radial-gradient(circle at 50% 60%, rgba(139, 92, 246, 0.4) 2px, transparent 3px),
                radial-gradient(circle at 70% 30%, rgba(59, 130, 246, 0.4) 2px, transparent 3px),
                radial-gradient(circle at 90% 70%, rgba(8, 145, 178, 0.4) 2px, transparent 3px),
                radial-gradient(circle at 20% 80%, rgba(139, 92, 246, 0.4) 2px, transparent 3px),
                radial-gradient(circle at 60% 10%, rgba(59, 130, 246, 0.4) 2px, transparent 3px),
                radial-gradient(circle at 80% 50%, rgba(8, 145, 178, 0.4) 2px, transparent 3px);
            background-size: 200px 200px;
            animation: nodesGlow 4s ease-in-out infinite;
        }
        @keyframes nodesGlow {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        /* Electric Lightning Effect */
        .lightning-container {
            position: fixed;
            inset: 0;
            z-index: -1;
            pointer-events: none;
            overflow: hidden;
        }
        .lightning {
            position: absolute;
            width: 2px;
            height: 100%;
            background: linear-gradient(to bottom, 
                transparent 0%, 
                rgba(59, 130, 246, 0.8) 30%, 
                rgba(139, 92, 246, 0.8) 50%, 
                rgba(59, 130, 246, 0.8) 70%, 
                transparent 100%);
            opacity: 0;
            animation: lightning 8s ease-in-out infinite;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.8);
        }
        .lightning:nth-child(1) { left: 10%; animation-delay: 0s; }
        .lightning:nth-child(2) { left: 30%; animation-delay: 2s; }
        .lightning:nth-child(3) { left: 50%; animation-delay: 4s; }
        .lightning:nth-child(4) { left: 70%; animation-delay: 6s; }
        .lightning:nth-child(5) { left: 90%; animation-delay: 1s; }
        @keyframes lightning {
            0%, 90%, 100% { opacity: 0; transform: scaleY(0); }
            91% { opacity: 1; transform: scaleY(1); }
            92% { opacity: 0; transform: scaleY(1); }
            93% { opacity: 1; transform: scaleY(1); }
            94%, 100% { opacity: 0; transform: scaleY(1); }
        }
        
        /* Animated Mesh Overlay */
        .animated-bg::before {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(139, 92, 246, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(8, 145, 178, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(236, 72, 153, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 90% 20%, rgba(59, 130, 246, 0.3) 0%, transparent 50%);
            animation: meshMove 25s ease infinite;
        }
        @keyframes meshMove {
            0%, 100% { opacity: 0.5; transform: scale(1) rotate(0deg); }
            33% { opacity: 0.7; transform: scale(1.2) rotate(120deg); }
            66% { opacity: 0.6; transform: scale(0.9) rotate(240deg); }
        }
        
        /* Floating Particles */
        .particles {
            position: fixed;
            inset: 0;
            z-index: -1;
            pointer-events: none;
            overflow: hidden;
        }
        .particle {
            position: absolute;
            width: 4px;
            height: 4px;
            background: rgba(255, 255, 255, 0.6);
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
            animation: floatParticle 20s infinite;
        }
        @keyframes floatParticle {
            0%, 100% {
                transform: translateY(0) translateX(0) scale(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
                transform: translateY(-20vh) translateX(20px) scale(1);
            }
            90% {
                opacity: 1;
                transform: translateY(-90vh) translateX(-50px) scale(1);
            }
            100% {
                transform: translateY(-100vh) translateX(100px) scale(0);
            }
        }
        
        /* Animations */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: scale(0.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(60px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        @keyframes slideInRight {
            from {
                opacity: 0;
                transform: translateX(-60px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }
        @keyframes rotate {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }
        @keyframes shimmer {
            0% {
                background-position: -1000px 0;
            }
            100% {
                background-position: 1000px 0;
            }
        }
        @keyframes glowPulse {
            0%, 100% {
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.4),
                            0 0 40px rgba(139, 92, 246, 0.2);
            }
            50% {
                box-shadow: 0 0 40px rgba(59, 130, 246, 0.6),
                            0 0 80px rgba(139, 92, 246, 0.4);
            }
        }
        
        /* Page Container */
        .page {
            display: none;
            min-height: 100vh;
            padding: 2rem;
            animation: fadeIn 0.6s ease-out;
        }
        .page.active {
            display: block;
        }
        
        /* ========== SIDEBAR MENU ========== */
        .sidebar-menu {
            position: fixed;
            top: 0;
            right: -320px;
            width: 320px;
            height: 100vh;
            background: linear-gradient(135deg, rgba(15, 23, 42, 0.98), rgba(30, 41, 59, 0.98));
            backdrop-filter: blur(20px);
            z-index: 10000;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: -5px 0 40px rgba(0, 0, 0, 0.5);
            border-left: 2px solid rgba(59, 130, 246, 0.5);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }
        
        .sidebar-menu.active {
            right: 0;
        }
        
        .sidebar-header {
            padding: 2rem;
            border-bottom: 2px solid rgba(59, 130, 246, 0.3);
            text-align: center;
            position: relative;
        }
        
        .sidebar-close {
            position: absolute;
            left: 1.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid rgba(239, 68, 68, 0.5);
            color: #f87171;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            font-size: 1.2rem;
        }
        
        .sidebar-close:hover {
            background: rgba(239, 68, 68, 0.4);
            transform: translateY(-50%) rotate(90deg);
        }
        
        .sidebar-title {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .user-avatar {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
        }
        
        .user-info {
            flex: 1;
        }
        
        .user-name {
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.3rem;
        }
        
        .user-email {
            color: #94a3b8;
            font-size: 0.9rem;
        }
        
        .sidebar-nav {
            padding: 1.5rem;
            flex: 1;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 1.5rem;
            color: #cbd5e1;
            text-decoration: none;
            border-radius: 12px;
            margin-bottom: 0.8rem;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .nav-item:hover {
            background: rgba(59, 130, 246, 0.15);
            color: white;
            transform: translateX(-5px);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3));
            color: white;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.2);
        }
        
        .nav-icon {
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .sound-control {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1rem 1.5rem;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 12px;
            margin-bottom: 1rem;
            border: 2px solid #334155;
        }
        
        .sound-label {
            color: white;
            font-weight: 600;
        }
        
        .sound-toggle-btn {
            position: relative;
            width: 60px;
            height: 30px;
            background: #374151;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .sound-toggle-btn.active {
            background: #10b981;
        }
        
        .sound-toggle-btn::after {
            content: '';
            position: absolute;
            top: 3px;
            right: 3px;
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s;
        }
        
        .sound-toggle-btn.active::after {
            transform: translateX(-30px);
        }
        
        .sidebar-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            padding: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-item {
            text-align: center;
            padding: 1rem;
            background: rgba(30, 41, 59, 0.8);
            border-radius: 10px;
            border: 2px solid #334155;
        }
        
        .stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.3rem;
        }
        
        .stat-text {
            color: #94a3b8;
            font-size: 0.8rem;
        }
        
        .sidebar-footer {
            padding: 1.5rem;
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: #64748b;
            font-size: 0.9rem;
        }
        
        /* ========== USER PANEL BUTTON ========== */
        .user-panel-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 9999;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(139, 92, 246, 0.9));
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.4);
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .user-panel-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.6);
        }
        
        /* ========== MODAL OVERLAY ========== */
        .sidebar-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        
        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        /* ========== TICKET MODAL ========== */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            z-index: 10001;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }
        
        .modal-overlay.active {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }
        
        .modal {
            background: linear-gradient(135deg, #0f172a, #1e293b);
            border-radius: 25px;
            padding: 2.5rem;
            width: 90%;
            max-width: 500px;
            border: 2px solid rgba(59, 130, 246, 0.5);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.6);
            position: relative;
            animation: slideInUp 0.4s ease-out;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .modal-title {
            font-size: 1.8rem;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .close-modal {
            background: rgba(239, 68, 68, 0.2);
            border: 2px solid rgba(239, 68, 68, 0.5);
            color: #f87171;
            border-radius: 10px;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .close-modal:hover {
            background: rgba(239, 68, 68, 0.4);
            transform: rotate(90deg);
        }
        
        /* ========== NOTIFICATIONS ========== */
        .notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9998;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .notification {
            background: linear-gradient(135deg, rgba(245, 158, 11, 0.9), rgba(217, 119, 6, 0.9));
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            box-shadow: 0 8px 25px rgba(245, 158, 11, 0.3);
            animation: slideInRight 0.3s ease-out;
            display: flex;
            align-items: center;
            gap: 10px;
            max-width: 350px;
        }
        
        .notification.warning {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9));
            box-shadow: 0 8px 25px rgba(239, 68, 68, 0.3);
        }
        
        .notification.success {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.9), rgba(21, 128, 61, 0.9));
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.3);
        }
        
        /* Welcome Page */
        .welcome-container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        /* Header with Logo */
        .welcome-header {
            display: flex;
            align-items: center;
            gap: 3rem;
            margin-bottom: 4rem;
            animation: slideInRight 0.8s ease-out;
        }
        
        /* Logo Container - Diamond Shape with Rounded Corners */
        .logo-container {
            width: 120px;
            height: 120px;
            position: relative;
            flex-shrink: 0;
            animation: pulse 3s ease-in-out infinite;
        }
        .logo-ring {
            position: absolute;
            inset: -8px;
            transform: rotate(45deg);
            border-radius: 20px;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.4), rgba(139, 92, 246, 0.4));
            backdrop-filter: blur(20px);
            border: 3px solid rgba(255, 255, 255, 0.3);
            animation: rotate 20s linear infinite, glowPulse 3s ease-in-out infinite;
        }
        .logo-inner {
            position: absolute;
            inset: 0;
            transform: rotate(45deg);
            border-radius: 18px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 
                0 20px 60px rgba(0, 0, 0, 0.5),
                inset 0 2px 10px rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }
        .logo-inner::before {
            content: '';
            position: absolute;
            inset: -50%;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 3s infinite;
        }
        .logo-inner img {
            width: 70%;
            height: 70%;
            object-fit: contain;
            position: relative;
            z-index: 2;
            transform: rotate(-45deg);
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
        }
        
        /* Header Text */
        .header-text {
            flex: 1;
            color: white;
        }
        .header-text h1 {
            font-size: clamp(2rem, 5vw, 3.2rem);
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #fff, #e0e7ff, #c7d2fe);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 4px 20px rgba(255, 255, 255, 0.3);
            position: relative;
        }
        .header-text h1::after {
            content: '';
            position: absolute;
            bottom: -10px;
            right: 0;
            width: 200px;
            height: 4px;
            background: linear-gradient(90deg, transparent, #3b82f6, #8b5cf6);
            border-radius: 2px;
        }
        .header-text p {
            font-size: clamp(1.1rem, 3vw, 1.8rem);
            opacity: 0.95;
            margin-bottom: 0.5rem;
        }
        .subtitle {
            font-size: clamp(0.9rem, 2vw, 1.2rem);
            opacity: 0.85;
        }
        
        /* Calculator Cards */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 3rem;
            margin-bottom: 3rem;
            animation: slideInUp 0.8s ease-out 0.2s both;
        }
        .calc-card {
            position: relative;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 30px 80px rgba(0, 0, 0, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
        }
        .calc-card::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(135deg, 
                rgba(59, 130, 246, 0.1), 
                rgba(139, 92, 246, 0.1), 
                rgba(236, 72, 153, 0.1));
            opacity: 0;
            transition: opacity 0.3s;
        }
        .calc-card:hover {
            transform: translateY(-20px) scale(1.02);
            box-shadow: 
                0 50px 100px rgba(0, 0, 0, 0.6),
                0 0 80px rgba(59, 130, 246, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.4);
            border-color: rgba(59, 130, 246, 0.5);
        }
        .calc-card:hover::before {
            opacity: 1;
        }
        
        /* Card Image Area */
        .card-image {
            height: 300px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            position: relative;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        .card-image::before {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                repeating-linear-gradient(45deg, transparent, transparent 20px, rgba(255,255,255,0.03) 20px, rgba(255,255,255,0.03) 40px);
            animation: slidePattern 20s linear infinite;
        }
        @keyframes slidePattern {
            0% { transform: translate(0, 0); }
            100% { transform: translate(40px, 40px); }
        }
        .card-image img {
            max-width: 90%;
            max-height: 90%;
            object-fit: contain;
            position: relative;
            z-index: 2;
            filter: drop-shadow(0 10px 30px rgba(0, 0, 0, 0.5));
            transition: transform 0.5s;
        }
        .calc-card:hover .card-image img {
            transform: scale(1.1) rotate(5deg);
        }
        
        /* Card Content */
        .card-content {
            padding: 2.5rem;
            background: linear-gradient(135deg, rgba(8, 145, 178, 0.9), rgba(14, 116, 144, 0.9));
            backdrop-filter: blur(10px);
            color: white;
            position: relative;
            overflow: hidden;
        }
        .calc-card.blue .card-content {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.9), rgba(30, 64, 175, 0.9));
        }
        .card-content::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.6), transparent);
            animation: shimmer 3s infinite;
        }
        .card-content h2 {
            font-size: 1.8rem;
            margin-bottom: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        .card-content h2 .emoji {
            font-size: 2rem;
            animation: pulse 2s ease-in-out infinite;
        }
        .card-content p {
            font-size: 1.1rem;
            line-height: 1.8;
            opacity: 0.95;
            margin-bottom: 2rem;
        }
        .card-cta {
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-size: 1.1rem;
            font-weight: 600;
        }
        .card-cta .arrow {
            font-size: 1.8rem;
            transition: transform 0.3s;
        }
        .calc-card:hover .card-cta .arrow {
            transform: translateX(-10px);
            animation: pulse 1s ease-in-out infinite;
        }
        
        /* Footer Badge */
        .footer-badge {
            text-align: center;
            animation: slideInUp 0.8s ease-out 0.4s both;
        }
        .badge {
            display: inline-flex;
            align-items: center;
            gap: 1rem;
            padding: 1.2rem 2.5rem;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(30px);
            border-radius: 50px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 1.1rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .version-tag {
            background: rgba(255, 255, 255, 0.25);
            padding: 0.4rem 1rem;
            border-radius: 25px;
            font-weight: 700;
        }
        
        /* Calculator Page */
        .calc-container {
            max-width: 1800px;
            margin: 0 auto;
        }
        .calc-header {
            background: linear-gradient(135deg, rgba(8, 145, 178, 0.95), rgba(14, 116, 144, 0.95));
            backdrop-filter: blur(20px);
            color: white;
            padding: 2rem;
            border-radius: 30px;
            margin-bottom: 2rem;
            position: relative;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 
                0 25px 60px rgba(8, 145, 178, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.3);
            animation: slideInUp 0.6s ease-out;
        }
        .calc-header::before {
            content: '';
            position: absolute;
            inset: 0;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 255, 255, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(255, 255, 255, 0.15) 0%, transparent 50%);
            animation: meshMove 15s ease-in-out infinite;
        }
        .calc-header > * {
            position: relative;
            z-index: 1;
        }
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.9rem 1.8rem;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            transition: all 0.3s;
        }
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateX(8px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }
        .calc-header h1 {
            font-size: clamp(1.6rem, 4vw, 2.5rem);
            margin-bottom: 0.6rem;
        }
        .calc-header p {
            font-size: clamp(0.9rem, 2.5vw, 1.2rem);
            opacity: 0.95;
        }
        
        /* Calculator Grid */
        .calc-grid {
            display: grid;
            grid-template-columns: 450px 1fr;
            gap: 2rem;
        }
        @media (max-width: 1200px) {
            .calc-grid {
                grid-template-columns: 1fr;
            }
        }
        .calc-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 30px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 
                0 25px 60px rgba(0, 0, 0, 0.3),
                inset 0 1px 0 rgba(255, 255, 255, 0.8);
            animation: slideInUp 0.6s ease-out;
        }
        .calc-panel:nth-child(2) {
            animation-delay: 0.1s;
        }
        .panel-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid #e0e7ff;
        }
        .panel-header svg {
            width: 28px;
            height: 28px;
            fill: #0891b2;
            filter: drop-shadow(0 2px 4px rgba(8, 145, 178, 0.3));
        }
        .panel-header h2 {
            font-size: 1.4rem;
            color: #1e293b;
        }
        
        /* Tabs */
        .tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            background: linear-gradient(135deg, #e0f2fe, #dbeafe);
            padding: 0.5rem;
            border-radius: 20px;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.1);
        }
        .tab {
            flex: 1;
            padding: 0.8rem 1rem;
            background: transparent;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 700;
            color: #475569;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        .tab:hover {
            background: rgba(8, 145, 178, 0.1);
            transform: translateY(-2px);
        }
        .tab.active {
            background: linear-gradient(135deg, #0891b2, #0e7490);
            color: white;
            box-shadow: 0 8px 20px rgba(8, 145, 178, 0.4);
            transform: translateY(-2px);
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeIn 0.3s ease-out;
        }
        
        /* Form Elements */
        .form-group {
            margin-bottom: 1.2rem;
        }
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 700;
            color: #1e293b;
            font-size: 0.9rem;
        }
        .form-group input,
        .form-group select {
            width: 100%;
            padding: 0.8rem 1rem;
            border: 2px solid #cbd5e1;
            border-radius: 12px;
            font-size: 0.95rem;
            transition: all 0.3s;
            background: white;
            font-weight: 500;
        }
        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: #0891b2;
            box-shadow: 0 0 0 4px rgba(8, 145, 178, 0.2);
            transform: translateY(-2px);
        }
        .form-group small {
            display: block;
            margin-top: 0.4rem;
            font-size: 0.8rem;
            color: #64748b;
        }
        
        /* Radio Options */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }
        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.9rem 1.2rem;
            background: linear-gradient(135deg, #e0f2fe, #dbeafe);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            border: 2px solid transparent;
            font-size: 0.9rem;
        }
        .radio-option:hover {
            background: linear-gradient(135deg, #bae6fd, #bfdbfe);
            transform: translateX(-5px);
            border-color: #0891b2;
        }
        .radio-option input {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .core-type-selector {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.8rem;
            margin-top: 0.6rem;
        }
        .core-option {
            background: linear-gradient(135deg, #e0f2fe, #dbeafe);
            padding: 1rem;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            border: 2px solid transparent;
            font-size: 0.9rem;
        }
        .core-option:hover {
            background: linear-gradient(135deg, #bae6fd, #bfdbfe);
            transform: scale(1.05) rotate(2deg);
            border-color: #0891b2;
        }
        .core-option.selected {
            background: linear-gradient(135deg, #0891b2, #0e7490);
            color: white;
            box-shadow: 0 8px 20px rgba(8, 145, 178, 0.4);
            border-color: #06b6d4;
        }
        
        /* Calculate Button */
        .calc-btn {
            width: 100%;
            padding: 1.2rem;
            margin-top: 1.5rem;
            background: linear-gradient(135deg, #0891b2, #0e7490);
            color: white;
            border: none;
            border-radius: 18px;
            font-size: 1.2rem;
            font-weight: 800;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            box-shadow: 0 15px 40px rgba(8, 145, 178, 0.4);
            transition: all 0.4s;
            position: relative;
            overflow: hidden;
        }
        .calc-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(45deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s;
        }
        .calc-btn:hover::before {
            transform: translateX(100%);
        }
        .calc-btn:hover {
            background: linear-gradient(135deg, #0e7490, #155e75);
            transform: translateY(-5px);
            box-shadow: 0 25px 60px rgba(8, 145, 178, 0.6);
        }
        .calc-btn:active {
            transform: translateY(-2px);
        }
        .calc-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .calc-btn svg {
            width: 24px;
            height: 24px;
            fill: white;
        }
        .loading-spinner {
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: rotate 1s linear infinite;
        }
        
        /* Export Button */
        .export-btn {
            width: 100%;
            padding: 1rem;
            margin-top: 1rem;
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: none;
            border-radius: 15px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.8rem;
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
            transition: all 0.3s;
        }
        .export-btn:hover {
            background: linear-gradient(135deg, #059669, #047857);
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(16, 185, 129, 0.6);
        }
        .export-btn svg {
            width: 22px;
            height: 22px;
            fill: white;
        }
        
        /* Formula Box */
        .formula-box {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            padding: 1.5rem;
            border-radius: 18px;
            margin-top: 1.5rem;
            border: 3px solid #93c5fd;
            box-shadow: 
                0 8px 20px rgba(59, 130, 246, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.5);
        }
        .formula-box h3 {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            margin-bottom: 1rem;
            color: #1e3a8a;
            font-size: 1rem;
        }
        .formula-box h3 svg {
            width: 20px;
            height: 20px;
            fill: #1e3a8a;
        }
        .formula-box p {
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            color: #1e3a8a;
            line-height: 1.8;
            font-weight: 600;
            margin-bottom: 0.4rem;
        }
        
        /* Results */
        .result-placeholder {
            text-align: center;
            padding: 3rem 2rem;
            background: linear-gradient(135deg, #f8fafc, #e0f2fe);
            border: 3px dashed #cbd5e1;
            border-radius: 25px;
        }
        .result-placeholder-icon {
            width: 90px;
            height: 90px;
            margin: 0 auto 1.2rem;
            background: linear-gradient(135deg, #e0f2fe, #bae6fd);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s ease-in-out infinite;
        }
        .result-placeholder-icon svg {
            width: 50px;
            height: 50px;
            fill: #0891b2;
        }
        .result-placeholder p {
            font-size: 1.1rem;
            color: #64748b;
        }
        .result-section {
            margin-bottom: 1.5rem;
            padding: 1.5rem;
            background: white;
            border: 3px solid #e5e7eb;
            border-radius: 18px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
            transition: all 0.3s;
            animation: slideInUp 0.4s ease-out;
        }
        .result-section:hover {
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.15);
            border-color: #bae6fd;
            transform: translateY(-3px);
        }
        .result-section h3 {
            color: #1e293b;
            margin-bottom: 1.2rem;
            padding-bottom: 0.8rem;
            border-bottom: 3px solid #e5e7eb;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 0.6rem;
        }
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0.6rem 0;
            padding: 1rem 1.2rem;
            background: linear-gradient(135deg, #f8fafc, #f1f5f9);
            border-radius: 12px;
            border-right: 4px solid #0891b2;
            transition: all 0.3s;
        }
        .result-item:hover {
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            transform: translateX(-8px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .result-item.highlight {
            background: linear-gradient(135deg, #e0f2fe, #bae6fd);
            border-right-color: #0e7490;
        }
        .result-label {
            color: #64748b;
            font-weight: 700;
            font-size: 0.95rem;
        }
        .result-value {
            color: #1e293b;
            font-weight: 800;
            font-size: 1.05rem;
            font-family: 'Courier New', monospace;
        }
        .result-item.highlight .result-value {
            color: #0e7490;
        }
        
        /* Calculation Steps */
        .calc-steps {
            background: linear-gradient(135deg, #f8fafc, #e5e7eb);
            padding: 1.5rem;
            border-radius: 18px;
            border: 3px solid #cbd5e1;
            margin-top: 1.5rem;
            box-shadow: inset 0 2px 8px rgba(0, 0, 0, 0.05);
        }
        .calc-steps h3 {
            margin-bottom: 1.2rem;
            color: #1e293b;
            font-size: 1.1rem;
        }
        .step {
            margin-bottom: 0.8rem;
            padding: 1.2rem;
            background: white;
            border-radius: 12px;
            border-right: 4px solid #0891b2;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            animation: slideInUp 0.3s ease-out;
            transition: all 0.3s;
        }
        .step:hover {
            transform: translateX(-5px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
        }
        .step strong {
            color: #1e293b;
        }
        
        /* Warning Box */
        .warning-box {
            background: linear-gradient(135deg, #fee2e2, #fecaca);
            padding: 1.5rem;
            border-radius: 18px;
            margin-top: 1.5rem;
            border: 3px solid #f87171;
            animation: slideInUp 0.3s ease-out;
            box-shadow: 0 8px 20px rgba(248, 113, 113, 0.2);
        }
        .warning-box h4 {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            margin-bottom: 1rem;
            color: #991b1b;
            font-size: 1.1rem;
        }
        .warning-box h4 svg {
            width: 22px;
            height: 22px;
            fill: #991b1b;
        }
        .warning-box ul {
            list-style: disc;
            padding-right: 1.5rem;
            line-height: 1.8;
            color: #991b1b;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        /* Success Box */
        .success-box {
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            padding: 1.5rem;
            border-radius: 18px;
            margin-top: 1.5rem;
            border: 3px solid #86efac;
            animation: slideInUp 0.3s ease-out;
            box-shadow: 0 8px 20px rgba(134, 239, 172, 0.2);
        }
        .success-box h4 {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            margin-bottom: 1rem;
            color: #166534;
            font-size: 1.1rem;
        }
        .success-box h4 svg {
            width: 22px;
            height: 22px;
            fill: #166534;
        }
        .success-box ul {
            list-style: disc;
            padding-right: 1.5rem;
            line-height: 1.8;
            color: #166534;
            font-weight: 600;
            font-size: 0.9rem;
        }
        
        /* Footer */
        .calc-footer {
            text-align: center;
            margin-top: 2rem;
        }
        .calc-footer .badge {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(30px);
        }
        
        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(30, 41, 59, 0.3);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.8), rgba(8, 145, 178, 0.8));
            border-radius: 10px;
            border: 2px solid rgba(255, 255, 255, 0.1);
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #2563eb, #0891b2);
        }
        
        /* Blue theme for Transformer */
        .calc-header.blue {
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.95), rgba(30, 64, 175, 0.95));
        }
        .panel-header.blue svg {
            fill: #2563eb;
        }
        .tabs.blue {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
        }
        .tab.blue.active {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            box-shadow: 0 8px 20px rgba(37, 99, 235, 0.4);
        }
        .result-item.blue {
            border-right-color: #2563eb;
        }
        .result-item.highlight.blue {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            border-right-color: #1e40af;
        }
        .result-item.highlight.blue .result-value {
            color: #1e40af;
        }
        .step.blue {
            border-right-color: #2563eb;
        }
        
        /* Modal Body */
        .modal-body {
            color: #cbd5e1;
        }
        
        .ticket-type-selector {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 1.5rem;
        }
        
        .ticket-type {
            background: rgba(30, 41, 59, 0.8);
            border: 2px solid #334155;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .ticket-type:hover {
            border-color: #3b82f6;
            transform: translateY(-3px);
        }
        
        .ticket-type.selected {
            background: rgba(59, 130, 246, 0.2);
            border-color: #3b82f6;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }
        
        .ticket-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 1.5rem;
        }
        
        .ticket-item {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.8rem;
            border-left: 4px solid #3b82f6;
        }
        
        .ticket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }
        
        .ticket-status {
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .status-open {
            background: rgba(34, 197, 94, 0.2);
            color: #86efac;
        }
        
        .status-closed {
            background: rgba(100, 116, 139, 0.2);
            color: #cbd5e1;
        }
        
        .ticket-date {
            font-size: 0.8rem;
            color: #94a3b8;
        }
        
        /* Spam Protection */
        .spam-block {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(20px);
            z-index: 10002;
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .spam-block.active {
            display: flex;
            animation: fadeIn 0.5s ease-out;
        }
        
        .spam-timer {
            font-size: 4rem;
            font-weight: bold;
            background: linear-gradient(135deg, #ef4444, #dc2626);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 1rem;
        }
        
        /* Responsive */
        @media (max-width: 768px) {
            .cards-grid {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            .welcome-header {
                flex-direction: column;
                text-align: center;
            }
            .header-text h1::after {
                right: 50%;
                transform: translateX(50%);
            }
            .calc-header {
                padding: 1.5rem;
            }
            .calc-panel {
                padding: 1.5rem;
            }
            .panel-header h2 {
                font-size: 1.2rem;
            }
            .calc-grid {
                grid-template-columns: 1fr;
            }
            .sidebar-menu {
                width: 100%;
                right: -100%;
            }
            .user-panel-btn {
                left: 50%;
                transform: translateX(-50%);
                width: auto;
                white-space: nowrap;
            }
            .ticket-type-selector {
                grid-template-columns: 1fr;
            }
            .sidebar-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            .notification {
                max-width: 300px;
                padding: 12px 20px;
            }
        }
    </style>
</head>
<body>
    <!-- User Panel Button -->
    <button class="user-panel-btn" onclick="toggleSidebar()">
        <svg class="nav-icon" viewBox="0 0 24 24">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
        </svg>
        <span id="userStatus">پنل کاربری</span>
    </button>
    
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" onclick="toggleSidebar()"></div>
    
    <!-- Sidebar Menu -->
    <div class="sidebar-menu">
        <div class="sidebar-header">
            <button class="sidebar-close" onclick="toggleSidebar()">
                <svg width="20" height="20" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                </svg>
            </button>
            <h2 class="sidebar-title">پنل کاربری</h2>
        </div>
        
        <div class="user-profile">
            <div class="user-avatar" id="sidebarAvatar">U</div>
            <div class="user-info">
                <div class="user-name" id="sidebarUsername">کاربر مهمان</div>
                <div class="user-email" id="sidebarEmail">وارد سیستم نشده‌اید</div>
            </div>
        </div>
        
        <div class="sidebar-nav">
            <div class="nav-item" onclick="showLoginModal()">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/>
                </svg>
                <span>ورود / ثبت‌نام</span>
            </div>
            
            <div class="nav-item" onclick="createNewTicket()">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                </svg>
                <span>تیکت جدید</span>
            </div>
            
            <div class="nav-item" onclick="viewMyTickets()">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z"/>
                </svg>
                <span>تیکت‌های من</span>
            </div>
            
            <div class="nav-item" onclick="viewCalculations()">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M9 18h6v-2H9v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
                </svg>
                <span>محاسبات من</span>
            </div>
            
            <div class="nav-item" onclick="showSettings()">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>
                </svg>
                <span>تنظیمات</span>
            </div>
            
            <div class="sound-control">
                <span class="sound-label">صدای سیستم</span>
                <div class="sound-toggle-btn active" id="soundToggle" onclick="toggleSound()"></div>
            </div>
            
            <div class="nav-item" onclick="showHelp()">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/>
                </svg>
                <span>راهنما</span>
            </div>
            
            <div class="nav-item" onclick="logout()">
                <svg class="nav-icon" viewBox="0 0 24 24">
                    <path fill="currentColor" d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>
                </svg>
                <span>خروج</span>
            </div>
        </div>
        
        <div class="sidebar-stats">
            <div class="stat-item">
                <div class="stat-number" id="sidebarOpenTickets">0</div>
                <div class="stat-text">تیکت فعال</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="sidebarTotalTickets">0</div>
                <div class="stat-text">کل تیکت‌ها</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="sidebarCalculations">0</div>
                <div class="stat-text">محاسبات</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="sidebarDays">0</div>
                <div class="stat-text">روز عضویت</div>
            </div>
        </div>
        
        <div class="sidebar-footer">
            نسخه ۲.۰ | طراحی توسط پارسا
        </div>
    </div>
    
    <!-- Animated Background -->
    <div class="animated-bg"></div>
    
    <!-- Circuit Background -->
    <div class="circuit-bg"></div>
    
    <!-- Lightning Effects -->
    <div class="lightning-container">
        <div class="lightning"></div>
        <div class="lightning"></div>
        <div class="lightning"></div>
        <div class="lightning"></div>
        <div class="lightning"></div>
    </div>
    
    <!-- Floating Particles -->
    <div class="particles" id="particles"></div>
    
    <!-- Notification Container -->
    <div class="notification-container" id="notificationContainer"></div>
    
    <!-- Spam Protection Block -->
    <div class="spam-block" id="spamBlock">
        <div class="spam-timer" id="spamTimer">60</div>
        <h2>شما به دلیل اسپم کردن مسدود شده‌اید!</h2>
        <p>لطفاً 60 ثانیه صبر کنید</p>
    </div>
    
    <!-- Login Modal -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title">ورود / ثبت‌نام</h2>
                <button class="close-modal" onclick="closeLoginModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>نام کاربری</label>
                    <input type="text" id="username" placeholder="نام کاربری خود را وارد کنید">
                </div>
                <div class="form-group">
                    <label>ایمیل</label>
                    <input type="email" id="email" placeholder="ایمیل معتبر وارد کنید">
                </div>
                <div class="form-group">
                    <label>رمز عبور</label>
                    <input type="password" id="password" placeholder="رمز عبور">
                </div>
                <button class="calc-btn" onclick="handleLogin()" id="loginBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24">
                        <path fill="white" d="M10.09 15.59L11.5 17l5-5-5-5-1.41 1.41L12.67 11H3v2h9.67l-2.58 2.59zM19 3H5c-1.11 0-2 .9-2 2v4h2V5h14v14H5v-4H3v4c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"/>
                    </svg>
                    <span>ورود / ثبت‌نام</span>
                </button>
                <p style="text-align: center; margin-top: 1rem; color: #94a3b8;">
                    با ورود به سیستم، به تمامی قابلیت‌های کاربری دسترسی خواهید داشت.
                </p>
            </div>
        </div>
    </div>
    
    <!-- Ticket Modal -->
    <div class="modal-overlay" id="ticketModal">
        <div class="modal">
            <div class="modal-header">
                <h2 class="modal-title" id="ticketModalTitle">ایجاد تیکت جدید</h2>
                <button class="close-modal" onclick="closeTicketModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="ticket-type-selector">
                    <div class="ticket-type selected" onclick="selectTicketType('support')">
                        <div>
                            <svg width="30" height="30" viewBox="0 0 24 24">
                                <path fill="#94a3b8" d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
                            </svg>
                        </div>
                        <div>پشتیبانی</div>
                    </div>
                    <div class="ticket-type" onclick="selectTicketType('suggestion')">
                        <div>
                            <svg width="30" height="30" viewBox="0 0 24 24">
                                <path fill="#94a3b8" d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7z"/>
                            </svg>
                        </div>
                        <div>پیشنهاد</div>
                    </div>
                    <div class="ticket-type" onclick="selectTicketType('bug')">
                        <div>
                            <svg width="30" height="30" viewBox="0 0 24 24">
                                <path fill="#94a3b8" d="M14 12h-4v-2h4v2zm0-4h-4V6h4v2zm6 2v6c0 1.1-.9 2-2 2h-2v2h-4v-2H8v2H4v-2H2v-2h2v-2H2V8h2V6H2V4h2V2h2v2h8V2h2v2h2v2h2v2h-2v2h2v2h-2v2h2v2h-2v2h2v-2h2v-2h-2v-2h2zm-2 0v6H6V8h12z"/>
                            </svg>
                        </div>
                        <div>گزارش باگ</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>عنوان تیکت</label>
                    <input type="text" id="ticketTitle" placeholder="عنوان تیکت را وارد کنید">
                </div>
                <div class="form-group">
                    <label>متن تیکت</label>
                    <textarea id="ticketMessage" rows="4" placeholder="متن تیکت خود را بنویسید..." style="width: 100%; padding: 0.8rem; border-radius: 12px; border: 2px solid #cbd5e1; background: white; font-family: inherit;"></textarea>
                </div>
                <button class="calc-btn" onclick="createTicket()" id="createTicketBtn">
                    <svg width="24" height="24" viewBox="0 0 24 24">
                        <path fill="white" d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                    </svg>
                    <span>ایجاد تیکت</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Tickets List Modal -->
    <div class="modal-overlay" id="ticketsListModal">
        <div class="modal" style="max-width: 600px;">
            <div class="modal-header">
                <h2 class="modal-title">تیکت‌های من</h2>
                <button class="close-modal" onclick="closeTicketsListModal()">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body">
                <div class="ticket-list" id="ticketList">
                    <div style="text-align: center; color: #94a3b8; padding: 2rem;">
                        <svg width="48" height="48" viewBox="0 0 24 24">
                            <path fill="#94a3b8" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
                        </svg>
                        <p style="margin-top: 1rem;">تیکتی یافت نشد</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Welcome Page -->
    <div id="welcomePage" class="page active">
        <div class="welcome-container">
            <!-- Header with Logo -->
            <div class="welcome-header">
                <!-- Logo on Right -->
                <div class="logo-container">
                    <div class="logo-ring"></div>
                    <div class="logo-inner">
                        <!-- SVG Logo -->
                        <svg width="70%" height="70%" viewBox="0 0 100 100" transform="rotate(-45)">
                            <defs>
                                <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#ffffff;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#e0e7ff;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <path d="M50 10 L90 50 L50 90 L10 50 Z" fill="url(#logoGradient)" stroke="#3b82f6" stroke-width="3"/>
                            <path d="M50 30 L70 50 L50 70 L30 50 Z" fill="#1e40af" opacity="0.8"/>
                            <circle cx="50" cy="50" r="10" fill="white"/>
                            <path d="M45 45 L55 55 M55 45 L45 55" stroke="#3b82f6" stroke-width="2"/>
                        </svg>
                    </div>
                </div>
                <!-- Header Text -->
                <div class="header-text">
                    <h1>ماشین حساب الکتریکال</h1>
                    <p>ابزار پیشرفته محاسبات مهندسی برق</p>
                    <p class="subtitle">لطفاً یکی از ماشین حساب‌های زیر را انتخاب کنید</p>
                </div>
            </div>
            
            <!-- Calculator Cards -->
            <div class="cards-grid">
                <!-- Motor Calculator Card -->
                <div class="calc-card cyan" onclick="selectCalculator('motor')">
                    <div class="card-image">
                        <!-- Motor SVG -->
                        <svg width="80%" height="80%" viewBox="0 0 200 200">
                            <defs>
                                <linearGradient id="motorGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#0891b2;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#0e7490;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <circle cx="100" cy="100" r="80" fill="url(#motorGradient)" opacity="0.1" stroke="#0891b2" stroke-width="2"/>
                            <circle cx="100" cy="100" r="60" fill="none" stroke="#0891b2" stroke-width="3"/>
                            <circle cx="100" cy="100" r="40" fill="none" stroke="#0891b2" stroke-width="2" stroke-dasharray="5,5"/>
                            
                            <!-- Coils -->
                            <path d="M60,100 A40,40 0 0,1 140,100 A40,40 0 0,1 60,100" fill="none" stroke="#0e7490" stroke-width="3"/>
                            <path d="M100,60 A40,40 0 0,1 100,140 A40,40 0 0,1 100,60" fill="none" stroke="#0e7490" stroke-width="3"/>
                            
                            <!-- Rotor -->
                            <circle cx="100" cy="100" r="25" fill="#1e293b" stroke="#0e7490" stroke-width="2"/>
                            <line x1="100" y1="75" x2="100" y2="125" stroke="#0e7490" stroke-width="2"/>
                            <line x1="75" y1="100" x2="125" y2="100" stroke="#0e7490" stroke-width="2"/>
                            
                            <!-- Shaft -->
                            <rect x="97.5" y="30" width="5" height="140" fill="#0e7490"/>
                        </svg>
                    </div>
                    <div class="card-content">
                        <h2>
                            <svg width="32" height="32" viewBox="0 0 24 24">
                                <path fill="white" d="M13 3v10h2V3h-2zm-2 0v10H9V3h2zm6 0v10h2V3h-2zm-8 18v-7h2v7h-2zm4 0v-7h2v7h-2zm4 0v-7h2v7h-2z"/>
                            </svg>
                            <span>محاسبات الکتروموتور</span>
                        </h2>
                        <p>محاسبه پارامترهای سیم پیچی الکتروموتور سه فاز با دقت بالا و پشتیبانی از انواع سیم پیچی</p>
                        <div class="card-cta">
                            <span>شروع محاسبات</span>
                            <span class="arrow">←</span>
                        </div>
                    </div>
                </div>
                
                <!-- Transformer Calculator Card -->
                <div class="calc-card blue" onclick="selectCalculator('transformer')">
                    <div class="card-image">
                        <!-- Transformer SVG -->
                        <svg width="80%" height="80%" viewBox="0 0 200 200">
                            <defs>
                                <linearGradient id="transformerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                    <stop offset="0%" style="stop-color:#2563eb;stop-opacity:1" />
                                    <stop offset="100%" style="stop-color:#1e40af;stop-opacity:1" />
                                </linearGradient>
                            </defs>
                            <!-- Core -->
                            <rect x="70" y="40" width="60" height="120" fill="none" stroke="#2563eb" stroke-width="3"/>
                            <rect x="75" y="45" width="50" height="110" fill="#1e293b" opacity="0.3"/>
                            
                            <!-- Primary Coils -->
                            <path d="M50,50 Q55,45 60,50 T70,50 T80,50 T90,50 T100,50" fill="none" stroke="#2563eb" stroke-width="2"/>
                            <path d="M50,150 Q55,155 60,150 T70,150 T80,150 T90,150 T100,150" fill="none" stroke="#2563eb" stroke-width="2"/>
                            
                            <!-- Secondary Coils -->
                            <path d="M130,70 Q135,65 140,70 T150,70 T160,70 T170,70 T180,70" fill="none" stroke="#1e40af" stroke-width="2"/>
                            <path d="M130,130 Q135,135 140,130 T150,130 T160,130 T170,130 T180,130" fill="none" stroke="#1e40af" stroke-width="2"/>
                            
                            <!-- Terminals -->
                            <circle cx="50" cy="50" r="3" fill="#2563eb"/>
                            <circle cx="50" cy="150" r="3" fill="#2563eb"/>
                            <circle cx="180" cy="70" r="3" fill="#1e40af"/>
                            <circle cx="180" cy="130" r="3" fill="#1e40af"/>
                            
                            <!-- Magnetic Field -->
                            <path d="M100,80 Q110,85 100,90 T80,95" fill="none" stroke="#3b82f6" stroke-width="1" opacity="0.5"/>
                            <path d="M100,110 Q110,115 100,120 T80,125" fill="none" stroke="#3b82f6" stroke-width="1" opacity="0.5"/>
                        </svg>
                    </div>
                    <div class="card-content">
                        <h2>
                            <svg width="32" height="32" viewBox="0 0 24 24">
                                <path fill="white" d="M16 3H5v18h14V8h-3zM7 19v-2h2v2H7zm0-4v-2h2v2H7zm0-4V9h2v2H7zm4 8v-2h2v2h-2zm0-4v-2h2v2h-2zm0-4V9h2v2h-2zm4 8v-2h2v2h-2zm0-4v-2h2v2h-2zm2-6V5h-2v2h-2V5h-2v2h-2V5H9v2H7V5H5v2h2v2H5v2h2v2H5v2h2v2H5v2h2v2h2v-2h2v2h2v-2h2v2h2v-2h2v2h2v-2h-2v-2h2v-2h-2v-2h2v-2h-2V9h2V7h-2V5h-2v2h-2zm-2 4v2h2V9h-2zm0 4v2h2v-2h-2zm0 4v2h2v-2h-2z"/>
                            </svg>
                            <span>محاسبات ترانسفورماتور</span>
                        </h2>
                        <p>محاسبه دقیق تمام پارامترهای ترانسفورماتور با الگوریتم پیشرفته و پشتیبانی از انواع هسته‌های مختلف</p>
                        <div class="card-cta">
                            <span>شروع محاسبات</span>
                            <span class="arrow">←</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Footer Badge -->
            <div class="footer-badge">
                <div class="badge">
                    <span>طراحی و توسعه توسط</span>
                    <strong>پارسا</strong>
                    <span class="version-tag">نسخه ۲.۰</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Motor Calculator Page -->
    <div id="motorPage" class="page">
        <div class="calc-container">
            <!-- Header -->
            <div class="calc-header">
                <button class="back-btn" onclick="backToWelcome()">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path fill="white" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                    <span>بازگشت به صفحه اصلی</span>
                </button>
                <h1>محاسبه سیم‌پیچی الکتروموتور</h1>
                <p>محاسبات تخصصی موتورهای سه فاز — مبتنی بر استانداردهای مهندسی</p>
            </div>
            
            <!-- Calculator Grid -->
            <div class="calc-grid">
                <!-- Input Panel -->
                <div class="calc-panel">
                    <div class="panel-header">
                        <svg width="28" height="28" viewBox="0 0 24 24">
                            <path fill="#0891b2" d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/>
                        </svg>
                        <h2>ورودی‌ها</h2>
                    </div>
                    
                    <!-- Tabs -->
                    <div class="tabs">
                        <button class="tab active" onclick="switchTab('basic', 'motor')">پایه</button>
                        <button class="tab" onclick="switchTab('winding', 'motor')">سیم پیچی</button>
                    </div>
                    
                    <!-- Basic Tab -->
                    <div id="motor-basic-tab" class="tab-content active">
                        <div class="form-group">
                            <label>توان (kW)</label>
                            <input type="number" id="motorPower" value="1.5" step="0.1" min="0.1">
                        </div>
                        <div class="form-group">
                            <label>ولتاژ (V)</label>
                            <input type="number" id="motorVoltage" value="380" min="1">
                        </div>
                        <div class="form-group">
                            <label>جریان (A)</label>
                            <input type="number" id="motorCurrent" value="3.5" step="0.1" min="0.1">
                        </div>
                        <div class="form-group">
                            <label>فرکانس (Hz)</label>
                            <input type="number" id="motorFrequency" value="50" min="1">
                        </div>
                        <div class="form-group">
                            <label>سرعت (RPM)</label>
                            <input type="number" id="motorRPM" value="1440" min="1">
                        </div>
                    </div>
                    
                    <!-- Winding Tab -->
                    <div id="motor-winding-tab" class="tab-content">
                        <div class="form-group">
                            <label>تعداد شیارها (Z)</label>
                            <input type="number" id="slotNumber" value="24" min="1">
                        </div>
                        <div class="form-group">
                            <label>تعداد فازها (m)</label>
                            <input type="number" id="phaseNumber" value="3" disabled>
                        </div>
                        <div class="form-group">
                            <label>تعداد قطب‌ها (P)</label>
                            <input type="number" id="poleNumber" value="4" min="2" step="2">
                        </div>
                        <div class="form-group">
                            <label>نوع سیم پیچی:</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="windingType" value="full" checked>
                                    <span>گام کامل</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="windingType" value="fractional">
                                    <span>گام کسری</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>قطر سیم (mm)</label>
                            <input type="number" id="wireDiameterMotor" value="0.8" min="0.1" max="5" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>اتصال:</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="connectionType" value="star" checked>
                                    <span>ستاره (Y)</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="connectionType" value="delta">
                                    <span>مثلث (∆)</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>سطح هسته (cm²)</label>
                            <input type="number" id="coreArea" value="18" min="5" step="0.5">
                            <small>تخمین: ~12 cm² / kW</small>
                        </div>
                    </div>
                    
                    <!-- Calculate Button -->
                    <button class="calc-btn" onclick="calculateMotor()">
                        <svg width="24" height="24" viewBox="0 0 24 24">
                            <path fill="white" d="M9 18h6v-2H9v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
                        </svg>
                        <span id="motorCalcBtnText">محاسبه</span>
                    </button>
                    
                    <!-- Formula Box -->
                    <div class="formula-box">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24">
                                <path fill="#1e3a8a" d="M9 18h6v-2H9v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
                            </svg>
                            <span>فرمول‌ها:</span>
                        </h3>
                        <p>N<sub>s</sub> = 120f / P</p>
                        <p>Y<sub>P</sub> = Z / (2P)</p>
                        <p>q = Z / (2P·m)</p>
                        <p>N<sub>ph</sub> = V / (4.44·f·k·B·A)</p>
                    </div>
                </div>
                
                <!-- Results Panel -->
                <div class="calc-panel" style="max-height: none; overflow-y: visible;">
                    <div class="panel-header">
                        <svg width="28" height="28" viewBox="0 0 24 24">
                            <path fill="#0891b2" d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                        </svg>
                        <h2>نتایج</h2>
                    </div>
                    <div id="motorResults">
                        <div class="result-placeholder">
                            <div class="result-placeholder-icon">
                                <svg width="50" height="50" viewBox="0 0 24 24">
                                    <path fill="#0891b2" d="M9 18h6v-2H9v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
                                </svg>
                            </div>
                            <p>نتایج اینجا نمایش داده می‌شود</p>
                        </div>
                    </div>
                    <button class="export-btn hidden" id="motorExportBtn" onclick="exportMotorToExcel()">
                        <svg width="22" height="22" viewBox="0 0 24 24">
                            <path fill="white" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        <span>دانلود Excel</span>
                    </button>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="calc-footer">
                <div class="badge">
                    <span>طراحی توسط</span>
                    <strong>پارسا</strong>
                    <span>|</span>
                    <span>نسخه ۲.۰</span>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Transformer Calculator Page -->
    <div id="transformerPage" class="page">
        <div class="calc-container">
            <!-- Header -->
            <div class="calc-header blue">
                <button class="back-btn" onclick="backToWelcome()">
                    <svg width="20" height="20" viewBox="0 0 24 24">
                        <path fill="white" d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                    </svg>
                    <span>بازگشت به صفحه اصلی</span>
                </button>
                <h1>محاسبه ترانسفورماتور</h1>
                <p>محاسبات دقیق پارامترهای ترانسفورماتور</p>
            </div>
            
            <!-- Calculator Grid -->
            <div class="calc-grid">
                <!-- Input Panel -->
                <div class="calc-panel">
                    <div class="panel-header blue">
                        <svg width="28" height="28" viewBox="0 0 24 24">
                            <path fill="#2563eb" d="M4 10.5c-.83 0-1.5.67-1.5 1.5s.67 1.5 1.5 1.5 1.5-.67 1.5-1.5-.67-1.5-1.5-1.5zm0-6c-.83 0-1.5.67-1.5 1.5S3.17 7.5 4 7.5 5.5 6.83 5.5 6 4.83 4.5 4 4.5zm0 12c-.83 0-1.5.68-1.5 1.5s.68 1.5 1.5 1.5 1.5-.68 1.5-1.5-.67-1.5-1.5-1.5zM7 19h14v-2H7v2zm0-6h14v-2H7v2zm0-8v2h14V5H7z"/>
                        </svg>
                        <h2>ورودی‌ها</h2>
                    </div>
                    
                    <!-- Tabs -->
                    <div class="tabs blue">
                        <button class="tab active" onclick="switchTab('basic', 'transformer')">پایه</button>
                        <button class="tab" onclick="switchTab('advanced', 'transformer')">پیشرفته</button>
                        <button class="tab" onclick="switchTab('core', 'transformer')">هسته</button>
                    </div>
                    
                    <!-- Basic Tab -->
                    <div id="transformer-basic-tab" class="tab-content active">
                        <div class="form-group">
                            <label>ولتاژ اولیه (V)</label>
                            <input type="number" id="primaryVoltage" value="220" min="1" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>ولتاژ ثانویه (V)</label>
                            <input type="number" id="secondaryVoltage" value="12" min="1" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>نوع ورودی:</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="powerType" value="power" checked onchange="togglePowerType()">
                                    <span>توان (VA)</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="powerType" value="current" onchange="togglePowerType()">
                                    <span>جریان (A)</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group" id="powerGroup">
                            <label>توان (VA)</label>
                            <input type="number" id="power" value="100" min="1" step="0.1">
                        </div>
                        <div class="form-group hidden" id="currentGroup">
                            <label>جریان (A)</label>
                            <input type="number" id="secondaryCurrent" value="8.33" min="0.1" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>فرکانس (Hz)</label>
                            <input type="number" id="frequency" value="50" min="1">
                        </div>
                    </div>
                    
                    <!-- Advanced Tab -->
                    <div id="transformer-advanced-tab" class="tab-content">
                        <div class="form-group">
                            <label>چگالی شار (T)</label>
                            <input type="number" id="fluxDensity" value="1.2" min="0.8" max="1.6" step="0.01">
                            <small>معمول: 1.0 - 1.4 تسلا</small>
                        </div>
                        <div class="form-group">
                            <label>تعیین سیم:</label>
                            <div class="radio-group">
                                <label class="radio-option">
                                    <input type="radio" name="wireSpecType" value="currentDensity" checked onchange="toggleWireSpec()">
                                    <span>چگالی جریان</span>
                                </label>
                                <label class="radio-option">
                                    <input type="radio" name="wireSpecType" value="wireDiameter" onchange="toggleWireSpec()">
                                    <span>قطر سیم</span>
                                </label>
                            </div>
                        </div>
                        <div class="form-group" id="currentDensityGroup">
                            <label>چگالی جریان (A/mm²)</label>
                            <input type="number" id="currentDensity" value="3" min="1" max="5" step="0.1">
                            <small>ایمن: 2.5 - 3.5</small>
                        </div>
                        <div class="form-group hidden" id="wireDiameterGroup">
                            <label>قطر سیم اولیه (mm)</label>
                            <input type="number" id="primaryWireDiameter" value="0.5" min="0.1" max="5" step="0.01">
                            <label for="secondaryWireDiameter" style="margin-top: 1rem;">قطر سیم ثانویه (mm)</label>
                            <input type="number" id="secondaryWireDiameter" value="1.2" min="0.1" max="5" step="0.01">
                        </div>
                        <div class="form-group">
                            <label>جنس سیم</label>
                            <select id="wireMaterial">
                                <option value="copper">مس</option>
                                <option value="aluminum">آلومینیوم</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Core Tab -->
                    <div id="transformer-core-tab" class="tab-content">
                        <div class="form-group">
                            <label>نوع هسته:</label>
                            <div class="core-type-selector">
                                <div class="core-option selected" data-type="EI" onclick="selectCoreType(this, 'EI')">EI</div>
                                <div class="core-option" data-type="UI" onclick="selectCoreType(this, 'UI')">UI</div>
                                <div class="core-option" data-type="Toroidal" onclick="selectCoreType(this, 'Toroidal')">توروئید</div>
                                <div class="core-option" data-type="C" onclick="selectCoreType(this, 'C')">C</div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>سایز هسته</label>
                            <select id="coreSize">
                                <option value="EI-48">EI-48 (4.8cm²)</option>
                                <option value="EI-54">EI-54 (5.4cm²)</option>
                                <option value="EI-60" selected>EI-60 (6.0cm²)</option>
                                <option value="EI-66">EI-66 (6.6cm²)</option>
                                <option value="EI-75">EI-75 (7.5cm²)</option>
                                <option value="EI-84">EI-84 (8.4cm²)</option>
                                <option value="EI-96">EI-96 (9.6cm²)</option>
                                <option value="EI-114">EI-114 (11.4cm²)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Calculate Button -->
                    <button class="calc-btn" onclick="calculateTransformer()">
                        <svg width="24" height="24" viewBox="0 0 24 24">
                            <path fill="white" d="M9 18h6v-2H9v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
                        </svg>
                        <span id="transformerCalcBtnText">محاسبه</span>
                    </button>
                    
                    <!-- Formula Box -->
                    <div class="formula-box">
                        <h3>
                            <svg width="20" height="20" viewBox="0 0 24 24">
                                <path fill="#1e3a8a" d="M9 18h6v-2H9v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
                            </svg>
                            <span>فرمول‌ها:</span>
                        </h3>
                        <p>N₁ = V₁ / (4.44 × f × B × A)</p>
                        <p>N₂ = V₂ / (4.44 × f × B × A)</p>
                        <p>A = I / J</p>
                        <p>R = ρ × L / A</p>
                    </div>
                </div>
                
                <!-- Results Panel -->
                <div class="calc-panel" style="max-height: none; overflow-y: visible;">
                    <div class="panel-header blue">
                        <svg width="28" height="28" viewBox="0 0 24 24">
                            <path fill="#2563eb" d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zm8 0c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
                        </svg>
                        <h2>نتایج</h2>
                    </div>
                    <div id="transformerResults">
                        <div class="result-placeholder">
                            <div class="result-placeholder-icon">
                                <svg width="50" height="50" viewBox="0 0 24 24">
                                    <path fill="#2563eb" d="M9 18h6v-2H9v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/>
                                </svg>
                            </div>
                            <p>نتایج اینجا نمایش داده می‌شود</p>
                        </div>
                    </div>
                    <button class="export-btn hidden" id="transformerExportBtn" onclick="exportTransformerToExcel()">
                        <svg width="22" height="22" viewBox="0 0 24 24">
                            <path fill="white" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM9 17H7v-7h2v7zm4 0h-2V7h2v10zm4 0h-2v-4h2v4z"/>
                        </svg>
                        <span>دانلود Excel</span>
                    </button>
                </div>
            </div>
            
            <!-- Footer -->
            <div class="calc-footer">
                <div class="badge">
                    <span>طراحی توسط</span>
                    <strong>پارسا</strong>
                    <span>|</span>
                    <span>نسخه ۲.۰</span>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // Global Variables
        let selectedCoreType = 'EI';
        let motorCalculationData = null;
        let transformerCalculationData = null;
        let isLoggedIn = false;
        let currentUser = null;
        let soundEnabled = true; // صدا به صورت پیش‌فرض فعال است
        let spamClickCount = 0;
        let lastClickTime = 0;
        let isBlocked = false;
        let userTickets = [];
        let selectedTicketType = 'support';
        let userCalculations = [];
        let audioContext;
        let sidebarOpen = false;
        
        // Initialize system
        function initSystem() {
            createParticles();
            loadUserData();
            setupSoundSystem();
            setupSpamProtection();
            setupSecurity();
            
            // Attach spam protection to all buttons
            document.querySelectorAll('button').forEach(btn => {
                btn.addEventListener('click', handleButtonClick);
            });
            
            // Set sound to enabled by default
            toggleSound(true);
            
            // Update UI
            updateUI();
        }
        
        // Create floating particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 40;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + '%';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (15 + Math.random() * 10) + 's';
                particlesContainer.appendChild(particle);
            }
        }
        
        // Sidebar Functions
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar-menu');
            const overlay = document.querySelector('.sidebar-overlay');
            
            sidebarOpen = !sidebarOpen;
            
            if (sidebarOpen) {
                sidebar.classList.add('active');
                overlay.classList.add('active');
                updateSidebarStats();
            } else {
                sidebar.classList.remove('active');
                overlay.classList.remove('active');
            }
        }
        
        function updateSidebarStats() {
            if (!currentUser) return;
            
            const openTickets = userTickets.filter(t => t.status === 'open').length;
            const totalTickets = userTickets.length;
            const totalCalculations = userCalculations.length;
            
            const joinDate = new Date(currentUser.joinDate);
            const daysSinceJoin = Math.floor((new Date() - joinDate) / (1000 * 60 * 60 * 24));
            
            document.getElementById('sidebarOpenTickets').textContent = openTickets;
            document.getElementById('sidebarTotalTickets').textContent = totalTickets;
            document.getElementById('sidebarCalculations').textContent = totalCalculations;
            document.getElementById('sidebarDays').textContent = daysSinceJoin;
            
            document.getElementById('sidebarAvatar').textContent = currentUser.username.charAt(0).toUpperCase();
            document.getElementById('sidebarUsername').textContent = currentUser.username;
            document.getElementById('sidebarEmail').textContent = currentUser.email;
        }
        
        // Navigation functions
        function selectCalculator(type) {
            document.getElementById('welcomePage').classList.remove('active');
            if (type === 'motor') {
                document.getElementById('motorPage').classList.add('active');
            } else {
                document.getElementById('transformerPage').classList.add('active');
            }
        }
        
        function backToWelcome() {
            document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
            document.getElementById('welcomePage').classList.add('active');
        }
        
        // Tab switching
        function switchTab(tabName, pageType) {
            const prefix = pageType === 'motor' ? 'motor-' : 'transformer-';
            document.querySelectorAll(`#${pageType}Page .tab`).forEach(t => t.classList.remove('active'));
            document.querySelectorAll(`#${pageType}Page .tab-content`).forEach(c => c.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById(prefix + tabName + '-tab').classList.add('active');
        }
        
        // Power type toggle
        function togglePowerType() {
            const powerType = document.querySelector('input[name="powerType"]:checked').value;
            document.getElementById('powerGroup').classList.toggle('hidden', powerType !== 'power');
            document.getElementById('currentGroup').classList.toggle('hidden', powerType !== 'current');
        }
        
        // Wire spec toggle
        function toggleWireSpec() {
            const wireSpecType = document.querySelector('input[name="wireSpecType"]:checked').value;
            document.getElementById('currentDensityGroup').classList.toggle('hidden', wireSpecType !== 'currentDensity');
            document.getElementById('wireDiameterGroup').classList.toggle('hidden', wireSpecType !== 'wireDiameter');
        }
        
        // Core type selection
        function selectCoreType(element, type) {
            document.querySelectorAll('.core-option').forEach(opt => opt.classList.remove('selected'));
            element.classList.add('selected');
            selectedCoreType = type;
        }
        
        // Ticket type selection
        function selectTicketType(type) {
            selectedTicketType = type;
            document.querySelectorAll('.ticket-type').forEach(t => t.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
        }
        
        // ========== USER SYSTEM ==========
        function showLoginModal() {
            closeAllModals();
            document.getElementById('loginModal').classList.add('active');
        }
        
        function closeLoginModal() {
            document.getElementById('loginModal').classList.remove('active');
        }
        
        function createNewTicket() {
            if (!isLoggedIn) {
                showNotification('لطفاً ابتدا وارد شوید', 'warning');
                showLoginModal();
                toggleSidebar();
                return;
            }
            
            closeAllModals();
            document.getElementById('ticketModal').classList.add('active');
            toggleSidebar();
        }
        
        function closeTicketModal() {
            document.getElementById('ticketModal').classList.remove('active');
        }
        
        function viewMyTickets() {
            if (!isLoggedIn) {
                showNotification('لطفاً ابتدا وارد شوید', 'warning');
                showLoginModal();
                toggleSidebar();
                return;
            }
            
            closeAllModals();
            updateTicketsList();
            document.getElementById('ticketsListModal').classList.add('active');
            toggleSidebar();
        }
        
        function closeTicketsListModal() {
            document.getElementById('ticketsListModal').classList.remove('active');
        }
        
        function closeAllModals() {
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.classList.remove('active');
            });
        }
        
        function handleLogin() {
            const username = document.getElementById('username').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (!username || !email || !password) {
                showNotification('لطفاً تمام فیلدها را پر کنید', 'warning');
                return;
            }
            
            if (!isValidEmail(email)) {
                showNotification('لطفاً یک ایمیل معتبر وارد کنید', 'warning');
                return;
            }
            
            // Simulate login/register
            currentUser = {
                username: username,
                email: email,
                joinDate: new Date(),
                tickets: []
            };
            
            isLoggedIn = true;
            saveUserData();
            updateUI();
            updateSidebarStats();
            
            document.getElementById('loginModal').classList.remove('active');
            showNotification('با موفقیت وارد شدید!', 'success');
            playSound('login');
        }
        
        function isValidEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }
        
        function loadUserData() {
            const saved = localStorage.getItem('electrical_calc_user');
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    currentUser = data;
                    isLoggedIn = true;
                } catch (e) {
                    console.log('Error loading user data');
                }
            }
            
            const savedTickets = localStorage.getItem('user_tickets');
            if (savedTickets) {
                try {
                    userTickets = JSON.parse(savedTickets);
                } catch (e) {
                    console.log('Error loading tickets');
                }
            }
            
            const savedCalculations = localStorage.getItem('user_calculations');
            if (savedCalculations) {
                try {
                    userCalculations = JSON.parse(savedCalculations);
                } catch (e) {
                    console.log('Error loading calculations');
                }
            }
            
            const savedSound = localStorage.getItem('sound_enabled');
            if (savedSound !== null) {
                soundEnabled = savedSound === 'true';
            }
        }
        
        function saveUserData() {
            if (currentUser) {
                localStorage.setItem('electrical_calc_user', JSON.stringify(currentUser));
            }
            localStorage.setItem('user_tickets', JSON.stringify(userTickets));
            localStorage.setItem('user_calculations', JSON.stringify(userCalculations));
            localStorage.setItem('sound_enabled', soundEnabled.toString());
        }
        
        function updateUI() {
            const userStatus = document.getElementById('userStatus');
            if (isLoggedIn && currentUser) {
                userStatus.textContent = currentUser.username;
            } else {
                userStatus.textContent = 'پنل کاربری';
            }
        }
        
        function updateTicketsList() {
            const ticketList = document.getElementById('ticketList');
            
            if (userTickets.length === 0) {
                ticketList.innerHTML = `
                    <div style="text-align: center; color: #94a3b8; padding: 2rem;">
                        <svg width="48" height="48" viewBox="0 0 24 24">
                            <path fill="#94a3b8" d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
                        </svg>
                        <p style="margin-top: 1rem;">تیکتی یافت نشد</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            userTickets.forEach(ticket => {
                const date = new Date(ticket.date);
                const statusClass = ticket.status === 'open' ? 'status-open' : 'status-closed';
                const statusText = ticket.status === 'open' ? 'باز' : 'بسته';
                const typeIcon = {
                    'support': '<svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/></svg>',
                    'suggestion': '<svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7z"/></svg>',
                    'bug': '<svg width="16" height="16" viewBox="0 0 24 24"><path fill="currentColor" d="M14 12h-4v-2h4v2zm0-4h-4V6h4v2zm6 2v6c0 1.1-.9 2-2 2h-2v2h-4v-2H8v2H4v-2H2v-2h2v-2H2V8h2V6H2V4h2V2h2v2h8V2h2v2h2v2h2v2h-2v2h2v2h-2v2h2v2h-2v2h2v-2h2v-2h-2v-2h2zm-2 0v6H6V8h12z"/></svg>'
                }[ticket.type];
                
                html += `
                    <div class="ticket-item">
                        <div class="ticket-header">
                            <strong style="color: white;">${ticket.title}</strong>
                            <span class="ticket-status ${statusClass}">${typeIcon} ${statusText}</span>
                        </div>
                        <p style="color: #cbd5e1; margin: 0.5rem 0;">${ticket.message.substring(0, 100)}...</p>
                        <div class="ticket-date">${date.toLocaleDateString('fa-IR')} - ${date.toLocaleTimeString('fa-IR')}</div>
                    </div>
                `;
            });
            ticketList.innerHTML = html;
        }
        
        function createTicket() {
            if (!isLoggedIn) {
                showNotification('لطفاً ابتدا وارد شوید', 'warning');
                return;
            }
            
            const title = document.getElementById('ticketTitle').value.trim();
            const message = document.getElementById('ticketMessage').value.trim();
            
            if (!title || !message) {
                showNotification('لطفاً عنوان و متن تیکت را وارد کنید', 'warning');
                return;
            }
            
            const newTicket = {
                id: Date.now(),
                title: title,
                message: message,
                type: selectedTicketType,
                status: 'open',
                date: new Date().toISOString(),
                user: currentUser.username
            };
            
            userTickets.unshift(newTicket);
            saveUserData();
            updateSidebarStats();
            
            document.getElementById('ticketTitle').value = '';
            document.getElementById('ticketMessage').value = '';
            
            document.getElementById('ticketModal').classList.remove('active');
            showNotification('تیکت شما با موفقیت ایجاد شد', 'success');
            playSound('success');
        }
        
        function viewCalculations() {
            if (!isLoggedIn) {
                showNotification('لطفاً ابتدا وارد شوید', 'warning');
                showLoginModal();
                toggleSidebar();
                return;
            }
            
            showNotification('لیست محاسبات شما در حال توسعه است', 'info');
            toggleSidebar();
        }
        
        function showSettings() {
            showNotification('تنظیمات در حال توسعه است', 'info');
            toggleSidebar();
        }
        
        function showHelp() {
            showNotification('راهنما در حال توسعه است', 'info');
            toggleSidebar();
        }
        
        function logout() {
            if (confirm('آیا مطمئن هستید که می‌خواهید خارج شوید؟')) {
                isLoggedIn = false;
                currentUser = null;
                saveUserData();
                updateUI();
                updateSidebarStats();
                showNotification('با موفقیت خارج شدید', 'success');
                toggleSidebar();
                playSound('success');
            }
        }
        
        // ========== SOUND SYSTEM ==========
        function setupSoundSystem() {
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                console.log('Web Audio API not supported');
            }
        }
        
        function toggleSound(forceEnable = null) {
            if (forceEnable !== null) {
                soundEnabled = forceEnable;
            } else {
                soundEnabled = !soundEnabled;
            }
            
            const soundToggle = document.getElementById('soundToggle');
            if (soundEnabled) {
                soundToggle.classList.add('active');
            } else {
                soundToggle.classList.remove('active');
            }
            
            saveUserData();
            
            if (soundEnabled) {
                playSound('toggle');
            }
        }
        
        function playSound(type) {
            if (!soundEnabled || !audioContext) return;
            
            try {
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                let frequency = 440;
                let duration = 0.1;
                
                switch(type) {
                    case 'click':
                        frequency = 523.25; // C5
                        break;
                    case 'success':
                        frequency = 659.25; // E5
                        break;
                    case 'error':
                        frequency = 392.00; // G4
                        break;
                    case 'login':
                        frequency = 784.00; // G5
                        break;
                    case 'toggle':
                        frequency = 349.23; // F4
                        break;
                    case 'notification':
                        frequency = 587.33; // D5
                        break;
                }
                
                oscillator.frequency.setValueAtTime(frequency, audioContext.currentTime);
                gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + duration);
                
                oscillator.start(audioContext.currentTime);
                oscillator.stop(audioContext.currentTime + duration);
            } catch (e) {
                console.log('Error playing sound:', e);
            }
        }
        
        // ========== SPAM PROTECTION ==========
        function setupSpamProtection() {
            // Reset spam counter every minute
            setInterval(() => {
                if (spamClickCount > 0) {
                    spamClickCount = Math.max(0, spamClickCount - 1);
                }
            }, 60000);
        }
        
        function handleButtonClick() {
            if (isBlocked) {
                event.preventDefault();
                return;
            }
            
            const now = Date.now();
            const timeSinceLastClick = now - lastClickTime;
            
            // If clicks are too fast (less than 300ms apart), count as spam
            if (timeSinceLastClick < 300) {
                spamClickCount++;
                
                if (spamClickCount >= 5 && spamClickCount < 10) {
                    showNotification(`لطفاً آرام تر کلیک کنید! (${spamClickCount}/10)`, 'warning');
                    playSound('error');
                } else if (spamClickCount >= 10) {
                    blockUser();
                }
            } else {
                // Reset spam counter if user is clicking at normal speed
                spamClickCount = Math.max(0, spamClickCount - 1);
            }
            
            lastClickTime = now;
            playSound('click');
        }
        
        function blockUser() {
            isBlocked = true;
            const spamBlock = document.getElementById('spamBlock');
            const spamTimer = document.getElementById('spamTimer');
            
            spamBlock.classList.add('active');
            
            let secondsLeft = 60;
            const timer = setInterval(() => {
                secondsLeft--;
                spamTimer.textContent = secondsLeft;
                
                if (secondsLeft <= 0) {
                    clearInterval(timer);
                    spamBlock.classList.remove('active');
                    isBlocked = false;
                    spamClickCount = 0;
                    showNotification('دسترسی شما بازگردانی شد', 'success');
                }
            }, 1000);
            
            showNotification('شما به دلیل اسپم کردن به مدت 60 ثانیه مسدود شدید!', 'warning');
        }
        
        // ========== SECURITY ==========
        function setupSecurity() {
            // Prevent right-click
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                showNotification('راست کلیک در این سایت غیرفعال است', 'warning');
            });
            
            // Prevent F12, Ctrl+Shift+I, Ctrl+Shift+J, Ctrl+U
            document.addEventListener('keydown', function(e) {
                if (
                    e.key === 'F12' ||
                    (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
                    (e.ctrlKey && e.key === 'u')
                ) {
                    e.preventDefault();
                    showNotification('این عمل مجاز نیست', 'warning');
                }
            });
            
            // Prevent text selection on some elements
            const noSelectElements = document.querySelectorAll('.calc-btn, .export-btn, .back-btn, .tab, .core-option');
            noSelectElements.forEach(el => {
                el.style.userSelect = 'none';
                el.style.webkitUserSelect = 'none';
            });
        }
        
        // ========== NOTIFICATION SYSTEM ==========
        function showNotification(message, type = 'info') {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = '';
            switch(type) {
                case 'success':
                    icon = '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="white" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';
                    break;
                case 'warning':
                    icon = '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="white" d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg>';
                    break;
                case 'error':
                    icon = '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="white" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>';
                    break;
                default:
                    icon = '<svg width="20" height="20" viewBox="0 0 24 24"><path fill="white" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-6h2v6zm0-8h-2V7h2v2z"/></svg>';
            }
            
            notification.innerHTML = `
                ${icon}
                <span>${message}</span>
            `;
            
            container.appendChild(notification);
            
            // Play notification sound
            playSound('notification');
            
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transform = 'translateX(100px)';
                setTimeout(() => {
                    container.removeChild(notification);
                }, 300);
            }, 3000);
        }
        
        // ========== CALCULATION FUNCTIONS ==========
        function calculateMotor() {
            const btn = document.getElementById('motorPage').querySelector('.calc-btn');
            const btnText = document.getElementById('motorCalcBtnText');
            btn.disabled = true;
            btnText.innerHTML = '<div class="loading-spinner"></div> در حال محاسبه...';
            
            setTimeout(() => {
                // Inputs
                const P_kW = parseFloat(document.getElementById('motorPower').value);
                const V_line = parseFloat(document.getElementById('motorVoltage').value);
                const I = parseFloat(document.getElementById('motorCurrent').value);
                const f = parseFloat(document.getElementById('motorFrequency').value);
                const Nr = parseFloat(document.getElementById('motorRPM').value);
                const Z = parseInt(document.getElementById('slotNumber').value);
                const m = 3;
                const P_poles = parseInt(document.getElementById('poleNumber').value);
                const windingType = document.querySelector('input[name="windingType"]:checked').value;
                const d_wire = parseFloat(document.getElementById('wireDiameterMotor').value);
                const connectionType = document.querySelector('input[name="connectionType"]:checked').value;
                const coreArea_cm2 = parseFloat(document.getElementById('coreArea').value);
                
                // Calculations
                const Ns = (120 * f) / P_poles;
                const S = ((Ns - Nr) / Ns * 100).toFixed(2);
                const YP = Z / (2 * P_poles);
                const q = Z / (2 * P_poles * m);
                const αe = (P_poles * 360) / Z;
                let YZ = Math.floor(YP);
                if (windingType === 'fractional') {
                    YZ = Math.floor(YP * 2 / 3);
                }
                
                const startPhase1 = 1;
                const startPhase2 = 1 + Math.round(120 / αe);
                const startPhase3 = 1 + Math.round(240 / αe);
                
                const B = 1.0;
                const kw = 0.92;
                const Ac = coreArea_cm2 / 10000;
                const V_ph = connectionType === 'star' ? V_line / Math.sqrt(3) : V_line;
                const N_phase = V_ph / (4.44 * f * kw * B * Ac);
                const coilsPerPhase = Z / (2 * m);
                const turnsPerCoil = Math.max(1, Math.round(N_phase / coilsPerPhase));
                const A_wire = (Math.PI * d_wire ** 2) / 4;
                const J = I / A_wire;
                const slotPitch = 0.015;
                const coilLength_m = YZ * slotPitch;
                const wireLengthPerCoil = 2 * turnsPerCoil * (coilLength_m + 0.1);
                const totalCoils = Z / 2;
                const totalWireLength = (wireLengthPerCoil * totalCoils).toFixed(2);
                
                // Store calculation data
                motorCalculationData = {
                    type: 'motor',
                    timestamp: new Date().toISOString(),
                    inputs: {
                        'توان (kW)': P_kW,
                        'ولتاژ (V)': V_line,
                        'جریان (A)': I,
                        'فرکانس (Hz)': f,
                        'سرعت (RPM)': Nr,
                        'شیار (Z)': Z,
                        'قطب (P)': P_poles,
                        'نوع سیم‌پیچی': windingType === 'full' ? 'گام کامل' : 'گام کسری',
                        'قطر سیم (mm)': d_wire,
                        'اتصال': connectionType === 'star' ? 'ستاره' : 'مثلث',
                        'هسته (cm²)': coreArea_cm2
                    },
                    results: {
                        'سرعت سنکرون (RPM)': Ns.toFixed(0),
                        'لغزش (%)': S,
                        'گام قطبی': YP.toFixed(2),
                        'q': q.toFixed(2),
                        'زاویه (°)': αe.toFixed(2),
                        'گام سیم‌پیچی': YZ,
                        'ولتاژ فاز (V)': V_ph.toFixed(2),
                        'دور فاز': N_phase.toFixed(0),
                        'دور کالف': turnsPerCoil,
                        'سطح سیم (mm²)': A_wire.toFixed(3),
                        'چگالی جریان (A/mm²)': J.toFixed(2),
                        'طول سیم (m)': totalWireLength,
                        'فاز U': startPhase1,
                        'فاز V': startPhase2,
                        'فاز W': startPhase3
                    }
                };
                
                // Save to user calculations if logged in
                if (isLoggedIn) {
                    userCalculations.unshift({
                        ...motorCalculationData,
                        id: Date.now()
                    });
                    saveUserData();
                    updateSidebarStats();
                }
                
                // Build results HTML
                let html = `
                    <div class="result-section">
                        <h3><svg width="20" height="20" viewBox="0 0 24 24"><path fill="#1e293b" d="M12 2L4.5 20.29l.71.71L12 18l6.79 3 .71-.71z"/></svg> مشخصات کلی</h3>
                        <div class="result-item highlight">
                            <span class="result-label">توان:</span>
                            <span class="result-value">${P_kW} kW</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">ولتاژ:</span>
                            <span class="result-value">${V_line} V</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">جریان:</span>
                            <span class="result-value">${I} A</span>
                        </div>
                        <div class="result-item highlight">
                            <span class="result-label">سرعت سنکرون:</span>
                            <span class="result-value">${Ns.toFixed(0)} RPM</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">لغزش:</span>
                            <span class="result-value">${S}%</span>
                        </div>
                    </div>
                    <div class="result-section">
                        <h3><svg width="20" height="20" viewBox="0 0 24 24"><path fill="#1e293b" d="M17.66 7.93L12 2.27 6.34 7.93c-3.12 3.12-3.12 8.19 0 11.31C7.9 20.8 9.95 21.58 12 21.58s4.1-.78 5.66-2.34c3.12-3.12 3.12-8.19 0-11.31zM12 19.59c-1.6 0-3.11-.62-4.24-1.76C6.62 16.69 6 15.19 6 13.59s.62-3.11 1.76-4.24L12 5.1v14.49z"/></svg> سیم‌پیچی</h3>
                        <div class="result-item">
                            <span class="result-label">گام قطبی:</span>
                            <span class="result-value">${YP.toFixed(2)}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">q:</span>
                            <span class="result-value">${q.toFixed(2)}</span>
                        </div>
                        <div class="result-item highlight">
                            <span class="result-label">گام:</span>
                            <span class="result-value">${YZ}</span>
                        </div>
                        <div class="result-item highlight">
                            <span class="result-label">دور کالف:</span>
                            <span class="result-value">${turnsPerCoil}</span>
                        </div>
                        <div class="result-item highlight">
                            <span class="result-label">طول سیم:</span>
                            <span class="result-value">${totalWireLength} m</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">چگالی جریان:</span>
                            <span class="result-value">${J.toFixed(2)} A/mm²</span>
                        </div>
                    </div>
                    <div class="result-section">
                        <h3><svg width="20" height="20" viewBox="0 0 24 24"><path fill="#1e293b" d="M3 5v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2H5c-1.11 0-2 .9-2 2zm12 4c0 1.66-1.34 3-3 3s-3-1.34-3-3 1.34-3 3-3 3 1.34 3 3zm-9 8c0-2 4-3.1 6-3.1s6 1.1 6 3.1v1H6v-1z"/></svg> فازها</h3>
                        <div class="result-item">
                            <span class="result-label">U:</span>
                            <span class="result-value">${startPhase1}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">V:</span>
                            <span class="result-value">${startPhase2}</span>
                        </div>
                        <div class="result-item">
                            <span class="result-label">W:</span>
                            <span class="result-value">${startPhase3}</span>
                        </div>
                    </div>
                `;
                
                document.getElementById('motorResults').innerHTML = html;
                document.getElementById('motorExportBtn').classList.remove('hidden');
                
                btn.disabled = false;
                btnText.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24"><path fill="white" d="M9 18h6v-2H9v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg> محاسبه';
                
                showNotification('محاسبات موتور با موفقیت انجام شد', 'success');
                playSound('success');
            }, 600);
        }
        
        function calculateTransformer() {
            const btn = document.getElementById('transformerPage').querySelector('.calc-btn');
            const btnText = document.getElementById('transformerCalcBtnText');
            btn.disabled = true;
            btnText.innerHTML = '<div class="loading-spinner"></div> در حال محاسبه...';
            
            setTimeout(() => {
                const V1 = parseFloat(document.getElementById('primaryVoltage').value);
                const V2 = parseFloat(document.getElementById('secondaryVoltage').value);
                const f = parseFloat(document.getElementById('frequency').value);
                const Bmax = parseFloat(document.getElementById('fluxDensity').value);
                const wireMaterial = document.getElementById('wireMaterial').value;
                const coreSize = document.getElementById('coreSize').value;
                
                let P, I2;
                const powerType = document.querySelector('input[name="powerType"]:checked').value;
                if (powerType === 'power') {
                    P = parseFloat(document.getElementById('power').value);
                    I2 = P / V2;
                } else {
                    I2 = parseFloat(document.getElementById('secondaryCurrent').value);
                    P = V2 * I2;
                }
                
                const ρ = wireMaterial === 'copper' ? 0.0175 : 0.0283;
                const coreSizeMap = {
                    'EI-48': 4.8, 'EI-54': 5.4, 'EI-60': 6.0, 'EI-66': 6.6,
                    'EI-75': 7.5, 'EI-84': 8.4, 'EI-96': 9.6, 'EI-114': 11.4
                };
                const Acore_cm2 = coreSizeMap[coreSize] || 6.0;
                const Acore = Acore_cm2 / 10000 * 0.95;
                
                const N1 = Math.round(V1 / (4.44 * f * Bmax * Acore));
                const N2 = Math.round(V2 / (4.44 * f * Bmax * Acore));
                const I1 = P / (V1 * 0.95);
                
                let A1, A2, d1, d2;
                const wireSpecType = document.querySelector('input[name="wireSpecType"]:checked').value;
                if (wireSpecType === 'currentDensity') {
                    const J = parseFloat(document.getElementById('currentDensity').value);
                    A1 = I1 / J;
                    A2 = I2 / J;
                    d1 = Math.sqrt((4 * A1) / Math.PI);
                    d2 = Math.sqrt((4 * A2) / Math.PI);
                } else {
                    d1 = parseFloat(document.getElementById('primaryWireDiameter').value);
                    d2 = parseFloat(document.getElementById('secondaryWireDiameter').value);
                    A1 = (Math.PI * d1 * d1) / 4;
                    A2 = (Math.PI * d2 * d2) / 4;
                }
                
                const coreTypeMLT = {
                    'EI': 10 + Acore_cm2 * 0.5,
                    'UI': 12 + Acore_cm2 * 0.6,
                    'Toroidal': 8 + Acore_cm2 * 0.4,
                    'C': 11 + Acore_cm2 * 0.55
                };
                const MLT = (coreTypeMLT[selectedCoreType] || 10) / 100;
                const L1 = (N1 * MLT).toFixed(2);
                const L2 = (N2 * MLT).toFixed(2);
                const R1 = (ρ * N1 * MLT / A1).toFixed(3);
                const R2 = (ρ * N2 * MLT / A2).toFixed(3);
                const Pcu1 = (I1 * I1 * ρ * N1 * MLT / A1).toFixed(2);
                const Pcu2 = (I2 * I2 * ρ * N2 * MLT / A2).toFixed(2);
                const Pcu_total = (parseFloat(Pcu1) + parseFloat(Pcu2)).toFixed(2);
                const Pfe = (2.5 * Acore_cm2 * 0.1).toFixed(2);
                const P_total = (parseFloat(Pcu_total) + parseFloat(Pfe)).toFixed(2);
                const efficiency = ((P / (P + parseFloat(P_total))) * 100).toFixed(2);
                const powerDensity = (P / Acore_cm2).toFixed(2);
                const J1_real = (I1 / A1).toFixed(2);
                const J2_real = (I2 / A2).toFixed(2);
                
                // Store calculation data
                transformerCalculationData = {
                    type: 'transformer',
                    timestamp: new Date().toISOString(),
                    inputs: {
                        'ولتاژ اولیه (V)': V1,
                        'ولتاژ ثانویه (V)': V2,
                        'توان (VA)': P,
                        'فرکانس (Hz)': f,
                        'چگالی شار (T)': Bmax,
                        'هسته': selectedCoreType,
                        'سایز': coreSize,
                        'سطح (cm²)': Acore_cm2,
                        'جنس': wireMaterial === 'copper' ? 'مس' : 'آلومینیوم'
                    },
                    results: {
                        'دور اولیه': N1,
                        'دور ثانویه': N2,
                        'نسبت': (V1/V2).toFixed(2),
                        'جریان اولیه (A)': I1.toFixed(3),
                        'جریان ثانویه (A)': I2.toFixed(3),
                        'قطر اولیه (mm)': d1.toFixed(2),
                        'قطر ثانویه (mm)': d2.toFixed(2),
                        'J اولیه (A/mm²)': J1_real,
                        'J ثانویه (A/mm²)': J2_real,
                        'طول اولیه (m)': L1,
                        'طول ثانویه (m)': L2,
                        'R اولیه (Ω)': R1,
                        'R ثانویه (Ω)': R2,
                        'تلفات مس (W)': Pcu_total,
                        'تلفات هسته (W)': Pfe,
                        'کل تلفات (W)': P_total,
                        'بازده (%)': efficiency
                    }
                };
                
                // Save to user calculations if logged in
                if (isLoggedIn) {
                    userCalculations.unshift({
                        ...transformerCalculationData,
                        id: Date.now()
                    });
                    saveUserData();
                    updateSidebarStats();
                }
                
                let html = `
                    <div class="result-section">
                        <h3><svg width="20" height="20" viewBox="0 0 24 24"><path fill="#1e293b" d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg> هسته</h3>
                        <div class="result-item"><span class="result-label">نوع:</span><span class="result-value">${selectedCoreType}</span></div>
                        <div class="result-item"><span class="result-label">سایز:</span><span class="result-value">${coreSize}</span></div>
                        <div class="result-item highlight"><span class="result-label">توان:</span><span class="result-value">${P} VA</span></div>
                    </div>
                    <div class="result-section">
                        <h3><svg width="20" height="20" viewBox="0 0 24 24"><path fill="#1e293b" d="M7 2v11h3v9l7-12h-4l4-8z"/></svg> الکتریکی</h3>
                        <div class="result-item highlight"><span class="result-label">N₁:</span><span class="result-value">${N1}</span></div>
                        <div class="result-item highlight"><span class="result-label">N₂:</span><span class="result-value">${N2}</span></div>
                        <div class="result-item"><span class="result-label">نسبت:</span><span class="result-value">${(V1/V2).toFixed(2)}</span></div>
                        <div class="result-item highlight"><span class="result-label">بازده:</span><span class="result-value">${efficiency}%</span></div>
                    </div>
                    <div class="result-section">
                        <h3><svg width="20" height="20" viewBox="0 0 24 24"><path fill="#1e293b" d="M17.66 7.93L12 2.27 6.34 7.93c-3.12 3.12-3.12 8.19 0 11.31C7.9 20.8 9.95 21.58 12 21.58s4.1-.78 5.66-2.34c3.12-3.12 3.12-8.19 0-11.31zM12 19.59c-1.6 0-3.11-.62-4.24-1.76C6.62 16.69 6 15.19 6 13.59s.62-3.11 1.76-4.24L12 5.1v14.49z"/></svg> سیم‌ها</h3>
                        <div class="result-item"><span class="result-label">d₁:</span><span class="result-value">${d1.toFixed(2)} mm</span></div>
                        <div class="result-item"><span class="result-label">d₂:</span><span class="result-value">${d2.toFixed(2)} mm</span></div>
                        <div class="result-item"><span class="result-label">L₁:</span><span class="result-value">${L1} m</span></div>
                        <div class="result-item"><span class="result-label">L₂:</span><span class="result-value">${L2} m</span></div>
                    </div>
                    <div class="result-section">
                        <h3><svg width="20" height="20" viewBox="0 0 24 24"><path fill="#1e293b" d="M13 5.08c3.06.44 5.48 2.86 5.92 5.92h3.03c-.47-4.72-4.23-8.48-8.95-8.95v3.03zM18.92 13c-.44 3.06-2.86 5.48-5.92 5.92v3.03c4.72-.47 8.48-4.23 8.95-8.95h-3.03zM11 18.92c-3.06-.44-5.48-2.86-5.92-5.92H2.05c.47 4.72 4.23 8.48 8.95 8.95v-3.03zM5.08 11c.44-3.06 2.86-5.48 5.92-5.92V2.05c-4.72.47-8.48 4.23-8.95 8.95h3.03z"/></svg> تلفات</h3>
                        <div class="result-item"><span class="result-label">مس:</span><span class="result-value">${Pcu_total} W</span></div>
                        <div class="result-item"><span class="result-label">هسته:</span><span class="result-value">${Pfe} W</span></div>
                        <div class="result-item highlight"><span class="result-label">کل:</span><span class="result-value">${P_total} W</span></div>
                    </div>
                `;
                
                document.getElementById('transformerResults').innerHTML = html;
                document.getElementById('transformerExportBtn').classList.remove('hidden');
                
                btn.disabled = false;
                btnText.innerHTML = '<svg width="24" height="24" viewBox="0 0 24 24"><path fill="white" d="M9 18h6v-2H9v2zM3 6v2h18V6H3zm3 7h12v-2H6v2z"/></svg> محاسبه';
                
                showNotification('محاسبات ترانسفورماتور با موفقیت انجام شد', 'success');
                playSound('success');
            }, 600);
        }
        
        // ========== EXCEL EXPORT FUNCTIONS ==========
        function exportMotorToExcel() {
            if (!motorCalculationData) return;
            
            const wb = XLSX.utils.book_new();
            
            // Create inputs sheet
            const inputsData = Object.entries(motorCalculationData.inputs).map(([key, value]) => [key, value]);
            const wsInputs = XLSX.utils.aoa_to_sheet([
                ['پارامتر', 'مقدار'],
                ...inputsData
            ]);
            XLSX.utils.book_append_sheet(wb, wsInputs, 'ورودی‌ها');
            
            // Create results sheet
            const resultsData = Object.entries(motorCalculationData.results).map(([key, value]) => [key, value]);
            const wsResults = XLSX.utils.aoa_to_sheet([
                ['پارامتر', 'مقدار'],
                ...resultsData
            ]);
            XLSX.utils.book_append_sheet(wb, wsResults, 'نتایج');
            
            // Download
            XLSX.writeFile(wb, `الکتروموتور_${new Date().toISOString().split('T')[0]}.xlsx`);
            showNotification('فایل اکسل با موفقیت دانلود شد', 'success');
        }
        
        function exportTransformerToExcel() {
            if (!transformerCalculationData) return;
            
            const wb = XLSX.utils.book_new();
            
            // Create inputs sheet
            const inputsData = Object.entries(transformerCalculationData.inputs).map(([key, value]) => [key, value]);
            const wsInputs = XLSX.utils.aoa_to_sheet([
                ['پارامتر', 'مقدار'],
                ...inputsData
            ]);
            XLSX.utils.book_append_sheet(wb, wsInputs, 'ورودی‌ها');
            
            // Create results sheet
            const resultsData = Object.entries(transformerCalculationData.results).map(([key, value]) => [key, value]);
            const wsResults = XLSX.utils.aoa_to_sheet([
                ['پارامتر', 'مقدار'],
                ...resultsData
            ]);
            XLSX.utils.book_append_sheet(wb, wsResults, 'نتایج');
            
            // Download
            XLSX.writeFile(wb, `ترانسفورماتور_${new Date().toISOString().split('T')[0]}.xlsx`);
            showNotification('فایل اکسل با موفقیت دانلود شد', 'success');
        }
        
        // Initialize the system
        window.addEventListener('DOMContentLoaded', initSystem);
        
        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl+S to toggle sidebar
            if (e.ctrlKey && e.key === 's') {
                e.preventDefault();
                toggleSidebar();
            }
            
            // Ctrl+M to toggle sound
            if (e.ctrlKey && e.key === 'm') {
                e.preventDefault();
                toggleSound();
            }
        });
    </script>
</body>
</html>
